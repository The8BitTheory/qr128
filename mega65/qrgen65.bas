#RetroDevStudio.MetaData.BASIC:8193,BASIC 65,uppercase,10,10
# END OF BASIC TEXT
3 DD=PEEK(186)
4 NV=83+16:DIM SC%(NV+1),CO%(4)
10 BE=WPEEK(130)

16 DEF FN LB(ZZ)=ZZ-INT(ZZ/256)*256
17 DEF FN HB(ZZ)=INT(ZZ/256)


# UPPER BOUND OF BASIC
#4 END

#20 BLOAD"QRM65.BIN",B0
30 H$="HTTPS://"
40 T$="GITHUB.COM/THE8BITTHEORY/QR128"
#15 POKE 53280,1:POKE 53281,1

50 T$=H$+T$

60 PRINT"GENERATING QR-CODE..."
70 S=TI:BANK0
80 P=POINTER(T$):SP=WPEEK(P+1)
90 SP$=HEX$(SP):LB=DEC(RIGHT$(SP$,2)):HB=DEC(LEFT$(SP$,2))
#43 POKE 780,LEN(T$)
#44 POKE 781,MOD(SP,16):POKE 782,INT(SP/16)

100 PRINT SP$,LB,HEX$(LB),HB,HEX$(HB)

110 SYS $0A7FF,LEN(T$),LB,HB

120 S=TI-S
130 RREG A,X,Y:F=X+Y*256:L=A

140 PRINT ""T$:PRINT"TOOK"S"JIFFIES"
160 CURSOR 40,0,0:PRINT "MATRIX AT"HEX$(F)", L="L
170 CURSOR 40,1,0:PRINT "1-3 CHANGE MASK"
180 CURSOR 40,2,0:PRINT "S   SAVE RUNTIME"
190 CURSOR 40,3,0:PRINT "N   NEW QR-CODE"
195 CURSOR 40,4,0:PRINT "R   RENDER WITH BASIC"
200 CURSOR 40,5,0:PRINT "X   EXIT"
201 GETKEY I$

202 IF ASC(I$)>48 THEN IF ASC(I$)<53 THEN BM=2(ASC(I$)-48):POKE ($0A7FF+7),BM:GOTO 60
204 IF I$="S" THEN 1000
206 IF I$="N" THEN 210
207 IF I$="R" THEN GOSUB 250
208 IF I$="X" THEN 240
209 GOTO 170




210 PRINT "URL TO ENCODE (WITHOUT "H$"):"
220 INPUT T$:IF T$="X" THEN END
230 GOTO 50

240 END



250 FOR Y=0 TO L-1
260  FOR X=0 TO L-1
270   PO=PEEK(F+X+Y*L)
280   IF (PO AND 32)=32 THEN PRINT " ";:GOTO 190
290   PRINT " ";
300  NEXT:PRINT
310 NEXT
320 RETURN


# SAVE FILE
1000 PRINT "PREPARING RUNTIME...";
1001 GOSUB 9000:AS=F:AE=AS+L:PRINT "DONE"
1005 PRINT "QRCODE FROM "AS" TO "AE" ("L" BYTES LONG)"

1100 INPUT "START ADDRESS OF QR-RUNTIME";A$
1105 INPUT "FILENAME";N$
1110 VL=VAL(A$)
1115 IF VL=$C000 THEN 1200

1120 V1=VL+94:V2=VL+46:V3=VL+78
1125 L1=FNLB(V1):H1=FNHB(V1)
1126 L2=FNLB(V2):H2=FNHB(V2)
1127 L3=FNLB(V3):H3=FNHB(V3)

1130 SC%(CO%(0))=L1:SC%(CO%(0)+1)=H1
1131 SC%(CO%(1))=L1:SC%(CO%(1)+1)=H1
1132 SC%(CO%(2))=L2:SC%(CO%(2)+1)=H2
1133 SC%(CO%(3))=L2:SC%(CO%(3)+1)=H2
1134 SC%(CO%(4))=L3:SC%(CO%(4)+1)=H3



1200 OPEN1,DD,1,N$+",P,W"

# WRITE ADDRESS-BYTES
1202 PRINT#1,CHR$(FNLB(VL));CHR$(FNHB(VL));

# WRITE QR-VIEWER RUNTIME
1205 FOR X=0 TO NV
1206  O$=CHR$(SC%(X))
1210  PRINT#1,O$;
1215  PRINT".";
1220 NEXT
1221 PRINT

# WRITE QR-CODE DATA
1222 FOR X=0 TO A:O$=CHR$(PEEK(AS+X))
1223  PRINT#1,O$;:PRINT".";
1224 NEXT
1225 PRINT
1230 CLOSE1

1999 GOTO 170


9000 RESTORE
9005 CO=0
9010 FOR X=0TONV
9020  READ D
9030  SC%(X)=D
9035  IF D=192 THEN CO%(CO)=X-1:CO=CO+1
9040 NEXT




9050 RETURN

10000 DATA 134,253,132,254,133,252,160,0,162,0,189,100,192,232,134,251
10010 DATA 141,83,192,141,82,192,166,251,189,100,192,72,74,74,74,74
10020 DATA 32,48,192,104,176,9,41,15,32,48,192,230,251,208,231,96
10030 DATA 170,189,84,192,145,253,200,204,82,192,208,18,206,83,192,240
10040 DATA 15,165,253,24,101,252,133,253,144,2,230,254,160,0,24,96
10050 DATA 56,96,0,0,32,126

10055 DATA 124,226,123,97,255,236,108,127
10060 DATA 225,251,98,252,254,160



#10000 DATA 134, 253, 132, 254, 133, 32, 160, 0
#10001 DATA 162, 0, 189, 94, 192, 232, 134, 251
#10002 DATA 133, 24, 133, 25, 166, 251, 189, 94
#10003 DATA 192, 72, 74, 74, 74, 74, 32, 46
#10004 DATA 192, 104, 176, 9, 41, 15, 32, 46
#10005 DATA 192, 230, 251, 208, 231, 96, 170, 189
#10006 DATA 78, 192, 145, 253, 200, 196, 25, 208
#10007 DATA 17, 198, 24, 240, 15, 165, 253, 24
#10008 DATA 101, 32, 133, 253, 144, 2, 230, 254
#10009 DATA 160, 0, 24, 96, 56, 96
#10010 DATA 32, 126
#10011 DATA 124, 226, 123, 97, 255, 236, 108, 127
#10012 DATA 225, 251, 98, 252, 254, 160
